-- Create database
CREATE DATABASE IF NOT EXISTS tax_assessment_db;
USE tax_assessment_db;

-- Client table
CREATE TABLE IF NOT EXISTS CLIENT_RECORD (
    PAN VARCHAR(10) PRIMARY KEY,
    NAME VARCHAR(100) NOT NULL,
    FATHERS_NAME VARCHAR(100) NOT NULL,
    DOB DATE NOT NULL,
    CATEGORY ENUM('INDV', 'HUF', 'FIRM', 'COMPANY') NOT NULL,
    ADDRESS TEXT NOT NULL,
    PHONE VARCHAR(15) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tax Return table
CREATE TABLE IF NOT EXISTS INCOME_TAX_RECORD (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    PAN VARCHAR(10) NOT NULL,
    ASSESSMENT_YEAR VARCHAR(9) NOT NULL,
    RETURN_ORIGINAL_REVISED BOOLEAN DEFAULT FALSE,
    GROSS_INCOME DECIMAL(15,2) NOT NULL,
    DEDUCTIONS DECIMAL(15,2) NOT NULL,
    TAXABLE_INCOME DECIMAL(15,2) NOT NULL,
    TAX_PAID DECIMAL(15,2) NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (PAN) REFERENCES CLIENT_RECORD(PAN),
    UNIQUE KEY unique_return (PAN, ASSESSMENT_YEAR, RETURN_ORIGINAL_REVISED)
);

-- Trading Account table
CREATE TABLE IF NOT EXISTS TRADING_ACCOUNT (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    PAN VARCHAR(10) NOT NULL,
    ASSES_YEAR_1 VARCHAR(9) NOT NULL,
    ASSES_YEAR_2 VARCHAR(9) NOT NULL,
    OPENING_STOCK DECIMAL(15,2) NOT NULL,
    PURCHASES DECIMAL(15,2) NOT NULL,
    DIRECT_EXPENSES DECIMAL(15,2) NOT NULL,
    CLOSING_STOCK DECIMAL(15,2) NOT NULL,
    GROSS_PROFIT DECIMAL(15,2) NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (PAN) REFERENCES CLIENT_RECORD(PAN),
    UNIQUE KEY unique_trading (PAN, ASSES_YEAR_1, ASSES_YEAR_2)
);

-- Profit & Loss Account table
CREATE TABLE IF NOT EXISTS PL_ACCOUNT (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    PAN VARCHAR(10) NOT NULL,
    ASSESSMENT_YEAR VARCHAR(9) NOT NULL,
    GROSS_PROFIT DECIMAL(15,2) NOT NULL,
    INDIRECT_INCOME DECIMAL(15,2) NOT NULL,
    INDIRECT_EXPENSES DECIMAL(15,2) NOT NULL,
    NET_PROFIT DECIMAL(15,2) NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (PAN) REFERENCES CLIENT_RECORD(PAN),
    UNIQUE KEY unique_pl (PAN, ASSESSMENT_YEAR)
);

-- Balance Sheet table
CREATE TABLE IF NOT EXISTS BALANCE_SHEET (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    PAN VARCHAR(10) NOT NULL,
    ASSESSMENT_YEAR VARCHAR(9) NOT NULL,
    ASSETS TEXT NOT NULL,
    LIABILITIES TEXT NOT NULL,
    CREATED_AT DATETIME NOT NULL,
    UPDATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (PAN) REFERENCES CLIENT_RECORD(PAN),
    UNIQUE KEY unique_balance (PAN, ASSESSMENT_YEAR)
);

-- Insert dummy data for clients
INSERT IGNORE INTO CLIENT_RECORD (PAN, NAME, FATHERS_NAME, DOB, CATEGORY, ADDRESS, PHONE, EMAIL, CREATED_AT) VALUES
('ABCDE1234F', 'John Doe', 'James Doe', '1990-01-01', 'INDV', '123 Main St, City', '1234567890', 'john@example.com', NOW()),
('BCDEF2345G', 'Jane Smith', 'Robert Smith', '1985-05-15', 'INDV', '456 Oak St, Town', '2345678901', 'jane@example.com', NOW()),
('CDEFG3456H', 'ABC Company', 'N/A', '2000-01-01', 'COMPANY', '789 Business Ave, City', '3456789012', 'abc@company.com', NOW()),
('DEFGH4567I', 'XYZ Firm', 'N/A', '1995-06-30', 'FIRM', '321 Corporate Blvd, Town', '4567890123', 'xyz@firm.com', NOW()),
('EFGHI5678J', 'HUF Family', 'N/A', '1980-12-25', 'HUF', '654 Family Lane, City', '5678901234', 'huf@family.com', NOW());

-- Insert dummy data for tax returns
INSERT IGNORE INTO INCOME_TAX_RECORD (PAN, ASSESSMENT_YEAR, RETURN_ORIGINAL_REVISED, GROSS_INCOME, DEDUCTIONS, TAXABLE_INCOME, TAX_PAID, CREATED_AT) VALUES
('ABCDE1234F', '2023-24', TRUE, 1200000, 200000, 1000000, 100000, NOW()),
('BCDEF2345G', '2023-24', TRUE, 900000, 150000, 750000, 75000, NOW()),
('CDEFG3456H', '2023-24', TRUE, 800000, 100000, 700000, 70000, NOW()),
('DEFGH4567I', '2023-24', TRUE, 5000000, 500000, 4500000, 450000, NOW()),
('EFGHI5678J', '2023-24', TRUE, 600000, 80000, 520000, 52000, NOW());

-- Insert dummy data for trading accounts
INSERT IGNORE INTO TRADING_ACCOUNT (PAN, ASSES_YEAR_1, ASSES_YEAR_2, OPENING_STOCK, PURCHASES, DIRECT_EXPENSES, CLOSING_STOCK, GROSS_PROFIT, CREATED_AT) VALUES
('ABCDE1234F', '2022-23', '2023-24', 200000, 600000, 50000, 250000, 600000, NOW()),
('BCDEF2345G', '2022-23', '2023-24', 150000, 400000, 30000, 180000, 340000, NOW()),
('CDEFG3456H', '2022-23', '2023-24', 100000, 300000, 20000, 120000, 260000, NOW());

-- Insert dummy data for P&L accounts
INSERT IGNORE INTO PL_ACCOUNT (PAN, ASSESSMENT_YEAR, GROSS_PROFIT, INDIRECT_INCOME, INDIRECT_EXPENSES, NET_PROFIT, CREATED_AT) VALUES
('ABCDE1234F', '2023-24', 600000, 50000, 100000, 550000, NOW()),
('BCDEF2345G', '2023-24', 340000, 20000, 50000, 310000, NOW()),
('CDEFG3456H', '2023-24', 260000, 15000, 30000, 245000, NOW());

-- Insert dummy data for balance sheets
INSERT IGNORE INTO BALANCE_SHEET (PAN, ASSESSMENT_YEAR, ASSETS, LIABILITIES, CREATED_AT) VALUES
('ABCDE1234F', '2023-24', '{"cash": 100000, "inventory": 250000, "equipment": 500000}', '{"loans": 300000, "creditors": 150000}', NOW()),
('BCDEF2345G', '2023-24', '{"cash": 80000, "inventory": 180000, "equipment": 400000}', '{"loans": 200000, "creditors": 120000}', NOW()),
('CDEFG3456H', '2023-24', '{"cash": 60000, "inventory": 120000, "equipment": 300000}', '{"loans": 150000, "creditors": 100000}', NOW());

